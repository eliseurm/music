<div #appContainer class="app-container" [class.fullscreen]="isFullscreen">
  <p-toast position="top-right"></p-toast>
  <p-confirmDialog></p-confirmDialog>
  <!-- Toolbar -->
  <app-toolbar
    [class.hidden]="isFullscreen"
    [zoomLevel]="zoomLevel"
    [currentKey]="currentKey"
    [showPositions]="showPositions"
    [instruments]="instruments"
    [fileName]="fileName"
    (zoomIn)="zoomIn()"
    (zoomOut)="zoomOut()"
    (toggleSidebar)="toggleSidebar()"
    (togglePositions)="togglePositions()"
    (transposeToKey)="transposeToKey($event)"
    (saveSettings)="saveSettings()"
    (toggleFullscreen)="toggleFullscreen()"
    (instrumentVisibilityChange)="onInstrumentVisibilityChange($event)">
  </app-toolbar>

  <div class="main-content">
    <!-- Sidebar para arquivos -->
    <app-file-explorer
      class="sidebar"
      [class.hidden]="!sidebarVisible || isFullscreen"
      (fileSelected)="loadScoreFromFile($event)"
      (driveFileSelected)="loadScoreFromGoogleDrive($event)"
      (scoreSelected)="loadSelectedScore($event)"
      (removeScores)="onRemoveScores($event)"
      (resetScore)="onResetScore($event)"
      (orderChanged)="onOrderChanged($event)"
      [disabled]="!isOSMDReady">
    </app-file-explorer>

    <!-- Área principal da partitura -->
    <div class="score-area" [class.fullscreen]="isFullscreen">
      <div #osmdContainer class="osmd-container">
        <!-- Mensagens de estado -->
        <div *ngIf="isLoading" class="state-message loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Carregando visualizador de partituras...</p>
        </div>

        <div *ngIf="errorMessage" class="state-message error">
          <i class="fas fa-exclamation-triangle"></i>
          <p>{{ errorMessage }}</p>
          <button class="btn-retry" (click)="initializeOSMD()">
            <i class="fas fa-redo"></i> Tentar novamente
          </button>
        </div>

        <div *ngIf="!isLoading && !errorMessage && !isOSMDReady" class="state-message info">
          <i class="fas fa-music"></i>
          <h3>Trombone Score Viewer</h3>
          <p>Inicializando visualizador de partituras...</p>
        </div>

      </div>
    </div>
  </div>

  <!-- Controles flutuantes no modo fullscreen (fora do container da partitura para garantir visibilidade) -->
  <div class="floating-controls" *ngIf="isFullscreen">
    <button class="float-btn" (click)="loadPreviousScore()" title="Partitura Anterior" *ngIf="selectedScores.length > 1">
      <i class="fas fa-chevron-left"></i>
    </button>
    <button class="float-btn" (click)="zoomOut()" title="Zoom -">
      <i class="fas fa-search-minus"></i>
    </button>
    <button class="float-btn" (click)="zoomIn()" title="Zoom +">
      <i class="fas fa-search-plus"></i>
    </button>
    <button class="float-btn" (click)="loadNextScore()" title="Próxima Partitura" *ngIf="selectedScores.length > 1">
      <i class="fas fa-chevron-right"></i>
    </button>
    <button class="float-btn" (click)="exitFullscreen()" title="Sair do modo tela cheia">
      <i class="fas fa-compress"></i>
    </button>
  </div>
</div>
